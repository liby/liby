- npm 全局安装的 pkg 在 zsh 中消失问题
	- Background
	  collapsed:: true
		- 使用 `npm install -g` 安装的全局包提供的命令（如 `claude`）突然无法访问
		- 即使反复重启终端也无法解决
		- 执行 `npm install -g` 重新安装（虽然报错）后，又神奇地可以使用了
			- ```
			  ❯ npm install -g @anthropic-ai/claude-code
			  npm error code ENOTEMPTY
			  npm error syscall rename
			  npm error path /Users/bryan/.npm-global/lib/node_modules/@anthropic-ai/claude-code
			  npm error dest /Users/bryan/.npm-global/lib/node_modules/@anthropic-ai/.claude-code-jtqndIsa
			  npm error errno -66
			  npm error ENOTEMPTY: directory not empty, rename '/Users/bryan/.npm-global/lib/node_modules/@anthropic-ai/claude-code' -> '/Users/bryan/.npm-global/lib/node_modules/@anthropic-ai/.claude-code-jtqndIsa'
			  npm error A complete log of this run can be found in: /Users/bryan/.npm/_logs/2025-06-24T05_07_47_119Z-debug-0.log
			  ```
	- Environment
	  collapsed:: true
		- **Shell**: zsh
		- **Node 管理工具**: proto
		- **npm prefix**: `~/.npm-global`
		- **系统**: macOS
	- Root Cause
	  collapsed:: true
		- zsh 的 hash table 缓存了 npm 安装过程中的**临时文件路径**
		- 例如：`.claude-FH0Al3gh` 而不是实际的 `claude`
		- npm 在安装包时使用临时文件进行原子性操作，包括创建命令的符号链接，但 zsh 可能在错误时机缓存了这些路径
	- Diagnostic
	  collapsed:: true
		- ```bash
		  # 查看命令缓存
		  hash | grep claude
		  # 输出可能显示临时文件：.claude-FH0Al3gh=/path/to/temp/file
		  
		  # 检查实际文件
		  ls -la ~/.npm-global/bin/claude
		  
		  # 验证 PATH
		  echo $PATH | tr ':' '\n' | grep npm
		  ```
	- Solution
	  collapsed:: true
		- 立即修复
			- ```bash
			  # 清除所有命令缓存
			  hash -r
			  
			  # 验证修复
			  which claude
			  ```
		- 永久解决 - 每次启动时刷新
			- ```.zshrc
			    hash -r 2>/dev/null || true
			  ```
	- Recap
	  collapsed:: true
		- **问题本质**: zsh hash table 缓存机制与 npm 临时文件冲突
		- **触发条件**: npm 全局包安装过程中创建命令链接时的时机问题
		- **为什么重新安装能修复**: `npm install` 操作会触发 hash table 的清理
	- Commands
	  collapsed:: true
		- `hash -r` - 清除所有命令缓存
		- `hash -d <command>` - 清除特定命令缓存
		- `hash` - 查看当前缓存的命令
		- `which <command>` - 查找命令实际路径
	- [GitHub issue](https://github.com/anthropics/claude-code/issues/1682)