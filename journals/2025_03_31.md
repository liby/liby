- [React visually explained: 'use client'](https://x.com/delba_oliveira/status/1840768815585472788)
	- **核心思想：**
		- `use client` 是 React（尤其是在 Next.js 等使用 React Server Components 的框架中）用来**标记代码边界**的指令。它告诉构建工具（bundler）：“**这个文件以及它导入的所有东西，都属于需要在浏览器（客户端）运行的代码包**”。
	- **为什么需要 `use client`？**
		- 1.  **统一开发模型：** 传统上，前端（客户端）和后端（服务器）开发使用不同的语言、框架和逻辑，导致在它们之间传递数据和状态很复杂（需要 API、序列化等）。React Server Components (RSC) 的目标是让开发者可以用**同一种语言 (JavaScript/JSX) 和组件模型**来编写跨越服务器和客户端的 UI 逻辑。
		- 2.  **区分运行环境：** Web 应用实际运行在两个环境：服务器和客户端。它们各有优势：
			- **服务器：** 适合访问数据库、文件系统、处理敏感信息（API 密钥）、执行 computationally expensive 的任务（如 Markdown 转换）、预渲染页面。
			- **客户端（浏览器）：** 适合访问 DOM、处理用户交互（点击、滚动）、管理本地状态（如下拉菜单开关）。
		- 3.  **优化打包：** 为了让应用高效运行，需要将代码打包并分发到正确的环境。`use client` 就是告诉打包工具“从这里开始，及其依赖，打包到客户端 bundle 里去”。
	- **`use client` 如何工作？**
		- 1.  **默认是 Server Components:** 在使用 RSC 的框架（如 Next.js App Router）中，默认情况下所有组件都是 Server Components，它们在服务器上运行，不能使用 `useState`, `useEffect` 等客户端 Hooks，也不能直接操作 DOM。
		- 2.  **标记边界:** 当你需要在组件中使用客户端特有的功能（如 Hooks、事件监听器）时，你需要在该文件的**顶部**添加 `'use client';` 指令。
		- 3.  **入口点原则:**
			- 你**不需要**在每个需要运行在客户端的文件里都添加 `use client`。
			- 只需要在**从服务器环境“进入”客户端环境的那个文件**（可以理解为 import 链中的第一个客户端文件）顶部标记 `use client` 即可。一旦一个模块被标记为 `use client`，它导入的所有其他模块（没有 `use client` 标记的）也会被包含在客户端的 bundle 中。
		- 4.  **从 Client 导入到 Server:** 如果一个 Server Component 导入了一个 Client Component，那么在服务器上，这个 Client Component 不会真正渲染，它只是一个**引用（placeholder）**。实际的渲染会发生在客户端。如果导入的是非组件值（如一个变量），在服务器上也会得到一个特殊的引用标记，而不是实际值。
	- **与 `use server` 的关系：**
		- `use server` **不是**用来标记 Server Components 的（组件默认就是 Server Component）。
		- `use server` 用来标记那些**定义在服务器上、但可以从客户端安全调用的函数**（称为 Server Actions）。这简化了客户端向服务器发送数据或触发操作的流程，React 会自动处理中间的网络通信。
	- **嵌套 Server Components 到 Client Components:**
		- 你**不能**直接在一个 Client Component 文件里 `import` 一个 Server Component（因为一旦进入 `use client` 区域，所有导入都会变成客户端模块）。
		- 解决方案是：通过 **props**（尤其是 `children` prop）将 Server Components **传递**给 Client Components。这样，服务器可以在一次渲染中完成所有 Server Components（包括那些要传递给 Client Components 的），然后将结果（包括 Client Component 的占位符和需要传递的 Server Component 的渲染结果）发送给客户端。客户端再渲染 Client Component，并将接收到的 Server Component HTML 放置在正确的位置。
	- **重要澄清：Client Components 也会在服务器上运行？**
		- 是的，这听起来可能有点反直觉。虽然 Client Components 的交互逻辑最终在客户端运行，但为了**首屏加载性能（SSR - Server-Side Rendering）和 SEO**，框架通常会在服务器上**预渲染 (pre-render)** Client Components 的初始 HTML 结构。
		- 用户访问页面时会先收到这个预渲染好的 HTML，可以立即看到内容。
		- 之后，客户端的 JavaScript 会加载并执行（这个过程叫 **Hydration 水合**），将事件监听器等交互功能“附加”到预渲染的 HTML 上，使页面变得完全可交互。
	- **总结：**
		- `use client` 是 React 扩展其组件模型以覆盖服务器和客户端的关键机制。它允许开发者在一个统一的范式下思考 UI 构建，通过简单的 `import`、`props` 和组件嵌套来处理跨网络边界的逻辑，而 React 和框架在幕后处理复杂的打包、环境区分和数据传递。这旨在简化开发体验，尽管底层机制复杂，但暴露给开发者的接口相对简单。它主要解决的是与 UI 相关的后端需求，而非替代所有通用的后端框架。
-